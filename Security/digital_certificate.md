# CA

在一个著名的小镇上有五个大公司，这五个大公司最近都发生了安全事件，有一个匿名的黑客通过它们的网络通信窃取了公司的机密，每个公司损失惨重。于是有一天，这五个公司的老总约好周五晚上在小红大排档撸串，一转眼周五晚上到了，五个公司老总撸完串后各自损失了多少钱，有没有什么办法保证公司的通信不被截取，在又撸了三串腰子后它们决定组件一个机构，这个机构负责颁发证书，以后需要加密的信息使用这个机构颁发的证书进行加密和通信，这个机构就是 CA。

既然需要给别人颁发证书和签名，那么首先自己需要有一个证书和密钥，这个就是根证书。但是它们中没有一个能够制造（小学都没毕业），这个时候它们听见老板娘小红在外面吆喝“小明，什么时候博士毕业，都读了七八年了”，它们忽然眼光一闪，把小明叫进来，说让小明给他们写两份文件，一份是密钥，一份是证书，小明一看这阵势，有点怕它们忽悠，于是小明说，你们写份保证书，说是你们自愿的，于是它们写好保证书（证书签名请求），小明给他们写了一份密钥（根密钥）和证书（根证书）。

有了根证书和密钥，那么接下来就是颁发证书和密钥了，大家都怕被坑，于是五个人自己哥先写了一个密码（密钥），然后根据密钥生成保证书（证书签名请求），利用根证书和根密钥对不同的证书签名请求进行签名，生成五分不同的证书和密钥，它们每人一份，以后的通信，它们携带上自己的证书。

但是也存在着证书被修改的可能性，于是大家约定好，将证书 hash 后用根证书加密（数字签名），将结果附在证书末尾。

通信时，一方接收到证书后，利用 CA 公钥值对证书末尾的数字签名进行解密，得到hash值，然后将证书的hash算法对证书进行hash，也的到一个值，判断两个值是否相等，如果相等，则认证成功。

然后双发运行Diffie Hellman 算法，简称 DH算法，这个算法会协商出一个key，这个key大家自己保存，然后利用 这个 key 推导出实际加密用的另一个 key，以后的加密解密就使用这个 key。

