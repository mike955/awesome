# redis 集群相关知识

redis cluster 存储没有使用一直散列，而是使用一种类似于分片（插槽）的形式，每一个键属于一个插槽（分片），redis 集群中有 16384 个 hash 插槽，集群中的每一个 master 负责一部分插槽，每个键的插槽散列值通过计算的出，计算方式为`HASH_SLOT = CRC16(key) mod 16384`，计算出来的值在某个插槽的范围内，则将该键值存储到负责该插槽的节点上。

ruby 的 hash 插槽计算方式如下
```ruby
def HASH_SLOT(key)
    s = key.index "{"
    if s
        e = key.index "}",s+1
        if e && e != s+1
            key = key[s+1..e-1]
        end
    end
    crc16(key) % 16384
end
```

## redis-cluster 集群特点

redis cluster 是 redis 分布式实现，能够实现一下目标，按重要性顺序排列：
 - 高性能和线性可扩展性，最多 1000 个节点。没有代理，使用异步复制，并且不对值执行合并操作
 - 可接受的写入安全程序：系统尝试（尽最大努力）保留所有的来自源客户端连接中的 master 节点的写入，通常有“小窗口”可以确认已丢失的写入，当客户端处于少数分区时数据丢失的概率相对大一些
 - 可用性：