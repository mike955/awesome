# Sentinel

Redis 的 Sentinel 系统用与管理多个 Redis 服务器，主要功能有下面三个:
 - 监控：sentinel 会不断检查你的主服务器和从服务器是否运行正常
 - 提醒：当被监控的某个 redis 服务出现问题时，sentinel 可以通过 API 向管理员或者其它应用程序发送通知
 - 自动故障迁移(Automatic failover)：当一个主服务器不能正常工作时，sentinel 会开始一次自动故障迁移操作，它会将失效的主服务器的其中一个从服务器升级为新的主服务器，并让失效主服务器的其他从服务器改为复制新的主服务器；当客户端试图连接失效的主服务器时，集群也会向客户端返回新的主服务器的地址，使得集群可以使用新主服务器代理失效服务器

Redis Sentinel 是一个分布式系统，你可以在一个架构中运行多个 Sentinel 进程，这些进程使用流言协议(gossip protocols)来接受关于主服务器是否下线的信息，并使用投票协议(agreement protocols)来决定是否执行自动故障迁移，以及选择从哪个从服务器作为新的主服务器。

Redis Sentinel 虽然后一个单独的可执行文件，实际上时一个运行在特殊模式下的 Redis server

## Sentinel vs cluster

### Redis Sentinel

Sentinel 主要用来监视主从实例，通知你有关更改的行为，在主服务器出现故障时自身充当配置提供者自动处理故障转移，使得 client 能够找到实例，不影响使用。

Sentinel 作为一个单独的程序运行，应该至少运行三个 sentinel 实例监视主节点及其从节点，Sentinel 会在执行故障转移时进行投票达成共识，当 sentinel为奇数个实例能够处理大多数问题。当 sentinel 出现故障时，必须要 保证 sentinel 的数量为 N/2 + 1 数量时仲裁才会生效。

一组 sentinel 能够监视多个 redis 主从节点，但是要确保名称不能混淆。

### Redis Cluster
cluster 是一种数据分片解决方案，具有自动管理、处理故障转移和复制的功能。

使用 redis cluster 将数据分散存储在多个节点上，每个节点数据都时完整数据的一个子集，从节点实例复制主节点服务的数据并充当备份实例，当主节点崩溃的时候，集群中的其余主节点会将崩溃主节点的子节点注册成主节点，实现故障转移。

使用 cluster 时，不需要额外的故障处理，并且不应该将 sentinel 实例指向任何 cluster 中任何节点