# RPC

 * rpc(Remote Proceduce Call远程过程调用)是一个计算机通信协议，该操作允许运行与一台计算机的程序调用另一台计算机的子程序，程序员无需额外地为这个交互作用编程
 * rpc 最核心要解决的问题就是在分布式系统间，如何执行另外一个地址空间上的函数、方法、就像在本地调用一样
 * rpc 远程调用使用 C/S模式，请求程序是一个 Client。服务程序是一个 Serve，远程过程调用是同步操作，在调用远程程序时，当前请求会暂停，等待返回结果
 * rpc 通信基于 TCP、UDP、HTTP等，通常基于 TCP
 * rpc 跨越传输层和应用层
 * rpc 调用协议包括传输协议与编码协议，传输协议扮包括 http 等，编码协议包括 protobuf 等
 * 我所理解的 RPC 是一个过程，这个过程中会使用到网络协议，是一个远程过程调用的操作

## 原理
一次客户端对服务器的RPC调用，内部操作大致有如下十步:
 - 调用客户端句柄，执行传送参数
 - 调用本地系统的内核发送网络消息
 - 消息传送到远程主机
 - 服务器句柄得到消息并取得参数
 - 执行远程过程
 - 执行的过程阿吉过返回服务器句柄
 - 服务器句柄返回结果，调用远程系统内核
 - 消息传回本地主机
 - 客户句柄由内核接收消息
 - 客户接收具柄返回数据

## rpc 框架需要解决的问题

 - Call ID 映射(调用 ID 映射): 在 RPC 调用中，所有的函数需要有自己的 ID，这个 ID 在所有进程中都是唯一确定的。客户端在做远程调用过程中必须附上这个 ID，还需要在客户端和服务端分别维护一个`{函数 <--> Call ID}`的映射表，两者的表不一定要完全一样，但是相同的函数对应的 Call ID 必须要一样，客户端在进行远程调用时，查找映射表，取出 Call ID 传给服务器，服务器通过 Call ID 查找映射表，来执行对象的函数
 - 序列化和反序列化: 客户端把参数转换成字节流，传递给服务器，服务器再把字节流转成子集能读取的格式，这个叫做序列化和反序列化
 - 网络传输: 客户端和服务器通过网络连接，因此需要一个网络传输层来传输数据，而这个网络传输层所使用的协议是不限的，gRPC 使用的是 HTTP2

如果解决上面的三个问题

 - Call ID：子集写映射表
 - 序列化和反序列化: protobuf 或者 flatBuffer之类的
 - 网络传输: 可以使用 TCP、UDP、或者自己写 socket